<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>JDBC Driver Support for High Availability, Disaster Recovery</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="62de4be6-b027-427d-a7e5-352960e42877" /><meta name="Description" content="In Microsoft JDBC Driver 4.0 for SQL Server, you can specify the Virtual Network Name (VNN) of a (high-availability, disaster-recovery) availability group (AG) in the connection property." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">JDBC Driver Support for High Availability, Disaster Recovery</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><font color="DarkGray"><p>[This documentation is for preview only, and is subject to change in later releases. Blank topics are included as placeholders.]</p></font><div class="introduction"><p>In Microsoft JDBC Driver 4.0 for SQL Server, you can specify the Virtual Network Name (VNN) of a (high-availability, disaster-recovery) availability group (AG) in the connection property. If a Microsoft JDBC Driver for SQL Server application is connected to a database that stops working, the application can expect to be connected to a failover database in no more than three (3) minutes.</p><p>Before availability groups, if multiple IP addresses were associated with a hostname, the JDBC driver attempted to connect to the first IP address. If the Microsoft JDBC Driver for SQL Server could not establish a connection with first IP address, the connection failed. The Microsoft JDBC Driver for SQL Server did not attempt to connect to any subsequent IP address associated with the hostname.</p><p>The JDBC driver can now attempt to connect to multiple IP addresses when an application connects to a VNN in an availability group.</p><p>The following <a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">connection properties</a> were added in Microsoft JDBC Driver 4.0 for SQL Server:</p><ul><li><p><span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span></p></li><li><p><span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span></p></li></ul><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>Increasing connection timeout and implementing connection retry logic will improve the probability that an application will connect to an availability group. You should double the connection timeout. Also, because a connection can fail because of an availability group failover, you should implement connection retry logic, retrying a failed connection up to four times.</p></div></div><h1 class="heading">Connecting With multiSubnetFailover</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>The <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> connection property indicates that the application is being deployed in an availability group and that the Microsoft JDBC Driver for SQL Server will try to connect to the the database on the primary SQL Server instance by trying to connect to all the AG’s IP addresses. If the <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> connection property is not used in the connection string, the Microsoft JDBC Driver for SQL Server will only try the first IP address in a connection attempt.</p><p>You should not use the <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> connection property if your Microsoft JDBC Driver for SQL Server application will not connect to an availability group.</p><p>Use the following guidelines to connect to a server in an availability group:</p><ul><li><p>If you use the <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> connection property when connecting to a single subnet, you may see a decrease in performance, compared to not using the <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> connection property when connecting to a single subnet.</p></li><li><p>To connect to an availability group, pass the VNN of the availability group to the jdbc:sqlserver connection string.  For example, jdbc:sqlserver://VNN1.</p></li><li><p>Connecting to a SQL Server instance configured with more than 64 IP addresses will cause a connection failure.</p></li><li><p>If the security manager is not installed, the Java Virtual Machine caches virtual IP addresses (VIPs) for a finite period of time, by default, defined by your JDK implementation and the java properties networkaddress.cache.ttl and networkaddress.cache.negative.ttl. If the JDK security manager is installed, the Java Virtual Machine will cache VIPs, and will not refresh the cache by default. You should set "time-to-live" (networkaddress.cache.ttl) to one day for the Java Virtual Machine cache. If you don’t change the default value to one day (or so), the old value will not be purged from the Java virtual machine cache when a VIP is added or updated. For more information about networkaddress.cache.ttl and networkaddress.cache.negative.ttl, see <a href="http://download.oracle.com/javase/6/docs/technotes/guides/net/properties.html">http://download.oracle.com/javase/6/docs/technotes/guides/net/properties.html</a>.</p></li><li><p>Behavior of an application that uses the <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> connection property is not affected based on the type of authentication: SQL Server Authentication, Kerberos Authentication, or Windows Authentication.</p></li><li><p>Because a failover connection may need up to three minutes to succeed, you should set the value of the <span sdata="langKeyword" value="loginTimeout"><span class="keyword">loginTimeout</span></span> connection property to 3 minutes or higher.</p></li><li><p>The driver will generate an error if the <span sdata="langKeyword" value="instanceName"><span class="keyword">instanceName</span></span> connection property is used in the same connection string as the <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> connection property. This reflects the fact that SQL Browser is not used in an availability group. However, if the <span sdata="langKeyword" value="portNumber"><span class="keyword">portNumber</span></span> connection property is also specified, the driver will ignore <span sdata="langKeyword" value="instanceName"><span class="keyword">instanceName</span></span> and use <span sdata="langKeyword" value="portNumber"><span class="keyword">portNumber</span></span>.</p></li><li><p>When using <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span>, distributed transactions are not supported.</p></li></ul></div><h1 class="heading">Upgrading to Use Multi-Subnet Clusters from Database Mirroring</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>If you upgrade a Microsoft JDBC Driver for SQL Server application that currently uses database mirroring to a multi-subnet scenario, you should remove the <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> connection property and replace it with the <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> connection property (and replace the server name in the connection string with a VNN). If a connection string uses <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> and <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> (or <span sdata="langKeyword" value="applicationIntent=ReadOnly"><span class="keyword">applicationIntent=ReadOnly</span></span>), the driver will generate an error. However, if a connection string uses <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> and <span sdata="langKeyword" value="multiSubnetFailover=false"><span class="keyword">multiSubnetFailover=false</span></span> (or <span sdata="langKeyword" value="applicationIntent=ReadWrite"><span class="keyword">applicationIntent=ReadWrite</span></span>), the application will use database mirroring.</p><p>The driver will return an error if database mirroring is used on the primary server in the AG, and if <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> (or <span sdata="langKeyword" value="applicationIntent=ReadOnly"><span class="keyword">applicationIntent=ReadOnly</span></span>) is used in the connection string that has <span sdata="langKeyword" value="serverName="><span class="keyword">serverName=</span></span><span class="parameter" sdata="paramReference">primary_server</span> instead of <span sdata="langKeyword" value="serverName="><span class="keyword">serverName=</span></span><span class="parameter" sdata="paramReference">VNN</span>.</p></div><h1 class="heading">Specifying Application Intent</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>The <b>applicationIntent</b> connection string keyword declares the application workload type when connecting to a server. Connecting to a secondary replica in an availability group will fail in the following situations:</p><ul><li><p>If an application uses <b>applicationIntent=ReadWrite</b> and the secondary replica is configured for read-only access.</p></li><li><p>If the secondary replica is not configured to accept connections.</p></li></ul><p>A connection will fail if a primary replica is configured to reject read-only workloads and the connection string contains <b>applicationIntent=ReadOnly</b>.</p></div><h1 class="heading">New Methods Supporting multiSubnetFailover and applicationIntent</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>The following methods give you programmatic access to the <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> and <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> connection string keywords:</p><ul><li><p><a href="19411e6c-c456-4533-8252-54569a2a6b1f.htm">SQLServerDataSource.getApplicationIntent</a></p></li><li><p><a href="e164c8ac-a0ae-4638-affb-ed454e7c0708.htm">SQLServerDataSource.setApplicationIntent</a></p></li><li><p><a href="1e8cb175-5f4c-4208-b4f5-3646990a30e3.htm">SQLServerDataSource.getMultiSubnetFailover</a></p></li><li><p><a href="7ffd282d-c2f6-4d1b-a7a6-859d18b388aa.htm">SQLServerDataSource.setMultiSubnetFailover</a></p></li><li><p><a href="b5eaad8a-31ef-44ac-af11-d5caa13ac3e2.htm">SQLServerDriver.getPropertyInfo</a></p></li></ul><p>The <span sdata="langKeyword" value="getMultiSubnetFailover"><span class="keyword">getMultiSubnetFailover</span></span>, <span sdata="langKeyword" value="setMultiSubnetFailover"><span class="keyword">setMultiSubnetFailover</span></span>, <span sdata="langKeyword" value="getApplicationIntent"><span class="keyword">getApplicationIntent</span></span>, and <span sdata="langKeyword" value="setApplicationIntent"><span class="keyword">setApplicationIntent</span></span> methods are also added to <span sdata="link"><a href="097434fd-2b74-411c-a5ed-eba04481dde5.htm">SQLServerDataSource Class</a></span>, <span sdata="link"><a href="b00e5a90-2af7-4d04-8ef8-256183777dcf.htm">SQLServerConnectionPoolDataSource Class</a></span>, and <span sdata="link"><a href="95fc7b07-2498-4a7e-8f7f-ee0d86b598b4.htm">SQLServerXADataSource Class</a></span>.</p></div><h1 class="heading">SSL Certificate Validation</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>An availability group consists of multiple physical servers. Microsoft JDBC Driver 4.0 for SQL Server added support for <span sdata="langKeyword" value="Subject Alternate Name"><span class="keyword">Subject Alternate Name</span></span> in SSL certificates so multiple hosts can be associated with the same certificate. For more information on SSL, see <span sdata="link"><a href="073f3b9e-8edd-4815-88ea-de0655d0325e.htm">Understanding SSL Support</a></span>.</p></div><span id="seeAlsoSpan"><h1 class="heading">See Also</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Setting the Connection Properties</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">Connecting to SQL Server with the JDBC Driver</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">
			Send
		<a href="javascript:SubmitFeedback('sqldocfb@microsoft.com','JDBC','JDBC','','01.00.11191.10000','%0\dThank%20you%20for%20your%20feedback.%20The%20developer%20writing%20teams%20use%20your%20feedback%20to%20improve%20documentation.%20While%20we%20are%20reviewing%20your%20feedback,%20we%20may%20send%20you%20e-mail%20to%20ask%20for%20clarification%20or%20feedback%20on%20a%20solution.%20We%20do%20not%20use%20your%20e-mail%20address%20for%20any%20other%20purpose%20and%20we%20delete%20it%20after%20we%20finish%20our%20review.%0\AFor%20further%20information%20about%20the%20privacy%20policies%20of%20Microsoft,%20please%20see%20http://privacy.microsoft.com/en-us/default.aspx.%0\A%0\d','Customer%20Feedback');">
			
      feedback
		</a>
			on this topic to Microsoft.
		</span><span id="copyrightarea"><p>
      © 2011 Microsoft Corporation. All rights reserved.
      </p></span></div></div></body></html>